name: Sync Frontend from AUR4

on:
  workflow_dispatch: # Manual trigger
  schedule:
    - cron: '0 */6 * * *' # Every 6 hours
  repository_dispatch:
    types: [aur4-updated]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout monorepo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Checkout aur4
        uses: actions/checkout@v4
        with:
          repository: carlo-spada/aur4
          path: aur4-temp
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Sync files
        run: |
          # Remove old frontend files (except .env and node_modules)
          find frontend -type f -not -path "frontend/.env" \
                              -not -path "frontend/node_modules/*" \
                              -not -path "frontend/.git/*" -delete

          # Copy new files from aur4
          cp -r aur4-temp/aur4/* frontend/
          rm -rf aur4-temp

      - name: Commit and push
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

          if ! git diff --quiet; then
            git add frontend/
            git commit -m "sync: Auto-update frontend from Lovable/aur4"
            git push
          else
            echo "No changes to sync"
          fi