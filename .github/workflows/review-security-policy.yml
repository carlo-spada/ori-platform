# .github/workflows/review-security-policy.yml
name: 'AI-Powered Security Policy Review'

on:
  workflow_dispatch: # Allows manual triggering
  schedule:
    - cron: '0 8 1 * *' # Runs at 08:00 on the 1st day of every month

jobs:
  ai_review:
    runs-on: ubuntu-latest
    name: 'Gemini Security Policy Analysis'
    permissions:
      contents: write # Allows the action to create a pull request
      pull-requests: write

    steps:
      - name: 'Checkout Repository'
        uses: actions/checkout@v4

      - name: 'Invoke Gemini for Policy Review'
        uses: google/gemini-cli@v0
        with:
          model: 'gemini-1.5-pro-latest'
          prompt: |
            As the project's AI Planner (Gemini), your task is to perform a scheduled review of our security policy.

            **Your Goal:** Ensure the `SECURITY.md` file accurately reflects the project's current security practices and tooling.

            **Your Workflow:**
            1.  **Read Key Files:** Read the contents of `SECURITY.md`, `AGENTS.md`, and all files in `.github/workflows/`.
            2.  **Analyze for Staleness:** Compare the documented security policy against our actual, implemented CI/CD workflows and agent responsibilities. Are there any new security-related tools (e.g., new linters, scanners) or processes mentioned in our GitHub Actions or agent guides that are NOT reflected in `SECURITY.md`?
            3.  **Take Action:**
                *   **If the policy is outdated:** Create a new branch named `gemini-security-policy-update` and modify the `SECURITY.md` file with the necessary updates. Then, create a pull request to merge this branch into `development`. The pull request body should clearly explain why the changes are necessary (e.g., "Updated policy to include the new 'trivy-scan' workflow.").
                *   **If the policy is up-to-date:** Your task is complete. Simply output a message stating: "Security policy review complete. No changes needed."

            Begin your analysis now.
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
