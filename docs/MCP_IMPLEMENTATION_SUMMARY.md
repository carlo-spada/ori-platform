# MCP Integration Master Plan: Executive Summary

**Project**: Phase 1 MCP Integration (Stripe, Resend, PostgreSQL)
**Created**: November 2025
**Status**: Planning Complete - Ready for Implementation
**Timeline**: 8 weeks (2-week sprints)
**Risk Level**: Low (Parallel operation, graceful deprecation)

---

## The Vision

Transform Ori Platform's development experience from a fragmented, multi-tool workflow into a **unified, MCP-first development environment** where payment testing, email management, and database exploration happen directly in Claude Code.

### Before MCP
- Developer → Stripe Dashboard → Email Provider → Database Client → IDE (4+ context switches)
- Manual payment testing ~15-30 minutes per session
- Email system placeholder (no sending capability)
- Database schema inspection requires leaving IDE

### After MCP
- Developer → Claude Code (MCP-powered IDE, zero context switches)
- Payment testing <3 minutes per session
- Full email service with templates and delivery
- Database schema inspection without leaving IDE

---

## Why This Matters: The Numbers

| Metric | Improvement | Impact |
|--------|-------------|--------|
| **Development Velocity** | 80-90% reduction in context-switching | Developers stay in flow state |
| **Payment Testing Time** | 15-30 min → <3 min per session | 5-10x faster iteration |
| **Onboarding Time** | 2-3 hours → <1 hour | Faster new developer productivity |
| **Email Infrastructure** | Non-existent → Production-ready | Scales with user base |
| **Test Coverage** | Current → +20% absolute increase | Safer deployments |
| **Team Productivity** | Context-switching overhead eliminated | ~1 developer-week saved per month |

---

## The Plan: 4 Phases Over 8 Weeks

### Phase 1: Foundation & Quick Wins (Weeks 1-2)
**Goal**: Bootstrap MCP servers, audit systems, create documentation

**What Gets Done**:
- ✅ Stripe, Resend, PostgreSQL MCPs operational locally
- ✅ Baseline audit of all affected systems
- ✅ Documentation structure established
- ✅ Team trained on MCP basics

**Deliverables**:
- `.claude/mcp.json` with Phase 1 MCPs configured
- `docs/MCP_INTEGRATION_MASTER_PLAN.md` (this guide)
- `docs/MCP_PHASE1_ARCHITECTURE.md` (technical architecture)
- `docs/MCP_MIGRATION_STRATEGIES.md` (specific migration paths)
- Updated `CLAUDE.md` with MCP patterns

**Success Metrics**:
- All three MCPs initialize without errors
- Team can set up local MCP environment in <5 minutes
- Zero ambiguity about what systems are affected

---

### Phase 2: Stripe MCP Integration (Weeks 3-4)
**Goal**: Replace manual Stripe dashboard testing with MCP-based workflows

**Current Problems**:
- Developers manually navigate Stripe dashboard (context-switching)
- Webhook testing requires external tools
- Payment scenarios require manual setup
- Test data isolated from code

**Solution**:
- Stripe MCP test helpers in Jest
- Automatic webhook simulation
- Test data generated by MCP
- All testing from IDE

**Deliverables**:
- `docs/STRIPE_MCP_WORKFLOWS.md` (testing guide)
- Updated payment test suite using Stripe MCP
- Webhook scenario generator
- `pnpm stripe:test-scenarios` command

**Success Metrics**:
- All existing payment tests pass with MCP approach
- Developers test payment flows without leaving IDE
- >90% test coverage for payment routes
- Stripe dashboard context-switching eliminated

**Deprecation Timeline**:
- Week 3-4: MCP tests added alongside old tests
- Week 4: Enforce MCP for new code
- Week 6: Remove manual testing documentation

---

### Phase 3: Resend MCP Integration (Weeks 5-6)
**Goal**: Implement production-ready email system using Resend MCP

**Current Problems**:
- `notifications.ts` is empty placeholder (119 lines of skeleton)
- Zero email sending capability
- User communications have no email component
- Scaling email requires complete system redesign

**Solution**:
- Full `EmailService` implementation using Resend MCP
- Email templates in version control
- Email triggers integrated into API routes
- Email testing and preview from IDE
- Production monitoring and health checks

**Deliverables**:
- `services/core-api/src/services/email.ts` (email service)
- `services/core-api/src/templates/` (email templates)
- `docs/RESEND_MCP_WORKFLOWS.md` (email workflows guide)
- Email health check endpoints
- Email monitoring dashboard

**Success Metrics**:
- All email trigger points working end-to-end
- Email testing possible entirely from IDE
- Email templates fully customizable and previewable
- >80% test coverage for email service
- Production Resend account verified and operational

**Deprecation Timeline**:
- Week 5: Email service implemented in parallel
- Week 5.5-6: Validation and production readiness
- Week 6: Enforce email service for all routes
- Week 8: Remove placeholder code

---

### Phase 4: PostgreSQL MCP Integration (Weeks 7-8)
**Goal**: Enable in-IDE database exploration and modernize database workflows

**Current Problems**:
- Developers use external tools (psql, DBeaver) for database work
- RLS policy testing requires manual SQL queries
- Migration testing requires manual database setup/cleanup
- Schema inspection context-switches away from IDE

**Solution**:
- PostgreSQL MCP integrated into test infrastructure
- RLS policy testing automated in Jest
- Migration validation built into CI
- Schema inspection and querying from IDE
- Database health monitoring endpoints

**Deliverables**:
- `services/core-api/src/lib/db-inspector.ts` (query tool)
- `services/core-api/src/__tests__/rls-helpers.ts` (RLS testing)
- `docs/POSTGRES_MCP_WORKFLOWS.md` (database workflows)
- Migration validation tool
- Database health check endpoints

**Success Metrics**:
- All schema queries runnable from IDE without external tools
- RLS policies fully testable via MCP
- All migrations validated before apply
- Context-switching for database work reduced by 85%+
- 100% of team using new workflows

**Deprecation Timeline**:
- Week 7: PostgreSQL MCP test infrastructure added
- Week 7.5-8: Database workflows modernized
- Week 8: Team trained on new patterns
- Week 10: External database tools become optional

---

## The Three Critical Features

### 1. Stripe MCP: Payment Testing Modernization

```
Old Flow (15-30 minutes):
Developer → Stripe Dashboard (context switch)
         → Click through menu navigation
         → Find test customer
         → Copy webhook JSON
         → Back to code, paste, run test

New Flow (<3 minutes):
Developer → Claude Code (in Stripe MCP)
         → "Create test customer with plus subscription"
         → "Simulate subscription update webhook"
         → Test data integrated directly into code
```

**Phase 2 Impact**:
- 80%+ reduction in payment testing time per session
- All testing from single IDE window
- Webhook payloads generated automatically
- Test coverage increases from current ~70% to >90%

---

### 2. Resend MCP: Production Email Infrastructure

```
Old State:
- services/core-api/src/utils/notifications.ts (placeholder, no sending)
- No email capability in production
- User communications missing

New State:
- Full EmailService with template system
- Welcome, recommendation, alert, receipt emails
- Production-ready with monitoring
- Email testing from IDE
```

**Phase 3 Impact**:
- User engagement improved (welcome emails, notifications)
- Scalable email infrastructure ready for growth
- Email development no longer deferred
- Platform more professional and complete

---

### 3. PostgreSQL MCP: Database Development Modernization

```
Old Flow (15-20 minutes per debugging session):
Developer → Open DBeaver/psql (context switch)
         → Write schema inspection query
         → Verify RLS policies manually
         → Copy findings back to IDE
         → Test manually

New Flow (<2 minutes per debugging session):
Developer → Claude Code (PostgreSQL MCP)
         → "Show schema for user_profiles"
         → "List RLS policies for applications"
         → Results displayed in IDE
```

**Phase 4 Impact**:
- 85%+ reduction in context-switching for database work
- RLS policy validation automated
- Migration validation built into CI
- All database work traceable and logged

---

## Risk Management: Why This Plan Is Safe

### Risk #1: MCP Server Unreliability
**Mitigation**: Parallel operation during transition, fallback to old systems until fully validated
**Fallback**: External tools remain available

### Risk #2: API Rate Limiting
**Mitigation**: Sandbox/test environments only, query caching, graceful degradation
**Fallback**: Manual configuration available

### Risk #3: Breaking Changes Mid-Phase
**Mitigation**: Tests validate both old and new systems simultaneously until deprecation
**Fallback**: `git revert` to previous commit

### Risk #4: Team Adoption Resistance
**Mitigation**: Early training, clear benefits, minimal disruption, 2-week buffer per deprecation
**Fallback**: Old workflows remain available for 2 weeks post-deprecation

### Risk #5: Integration Complexity
**Mitigation**: Weekly progress reviews, clear criteria before advancing phases, buffer time in schedule
**Fallback**: Skip phase if not working, handle in Phase 2

---

## Success Criteria: How We Know It Worked

### Phase 1 Success
- [ ] All three MCP servers initialize successfully locally
- [ ] Team can set up in <5 minutes
- [ ] Documentation complete and clear
- [ ] Zero ambiguity about affected systems

### Phase 2 Success
- [ ] >90% test coverage for payment routes
- [ ] Zero context-switching for payment testing
- [ ] All payment scenarios testable via MCP
- [ ] Team consensus on quality

### Phase 3 Success
- [ ] Email service fully operational and tested
- [ ] >80% test coverage for email service
- [ ] All email workflows automated
- [ ] Zero manual email configuration needed

### Phase 4 Success
- [ ] 85%+ reduction in database context-switching
- [ ] All RLS policies automatically testable
- [ ] All migrations validated before apply
- [ ] 100% team adoption of new patterns

---

## Documentation & Knowledge Transfer

### Documents Created (This Plan)
1. **MCP_INTEGRATION_MASTER_PLAN.md** ← You are here
   - Executive summary, risk management, timelines

2. **MCP_PHASE1_ARCHITECTURE.md**
   - Technical architecture diagrams
   - Network flows and security
   - Component integration details

3. **MCP_MIGRATION_STRATEGIES.md**
   - Specific migration paths for each system
   - Phase-by-phase implementation
   - Deprecation procedures

4. **docs/STRIPE_MCP_WORKFLOWS.md** (Phase 2)
   - Payment testing patterns
   - Webhook simulation workflows
   - Test data generation

5. **docs/RESEND_MCP_WORKFLOWS.md** (Phase 3)
   - Email template management
   - Email testing patterns
   - Template variable interpolation

6. **docs/POSTGRES_MCP_WORKFLOWS.md** (Phase 4)
   - Schema inspection patterns
   - RLS policy testing
   - Migration validation

### Updated Existing Docs
- **CLAUDE.md**: New "MCP-First Development Patterns" section
- **AGENTS.md**: Updated workflow section with MCP integration
- **README.md**: Development setup includes MCP server instructions

---

## The 8-Week Timeline

```
┌────────────────────────────────────────────────────────────────────────┐
│ WEEK 1-2: Phase 1 - Foundation & Quick Wins                           │
├────────────────────────────────────────────────────────────────────────┤
│ Mon: Kickoff, review plan, assign tasks                               │
│ Tue-Wed: Infrastructure audit (Stripe, Resend, PostgreSQL)            │
│ Thu: MCP server setup and local testing                               │
│ Fri: Documentation complete, team training, commit Phase 1            │
│ Mon-Fri (Week 2): Buffer, questions, contingencies                    │
└────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────┐
│ WEEK 3-4: Phase 2 - Stripe MCP Integration                            │
├────────────────────────────────────────────────────────────────────────┤
│ Mon-Tue (Week 3): Add Stripe MCP test helpers, create test suite     │
│ Wed-Thu: Convert existing tests to Stripe MCP, fix issues             │
│ Fri: All payment tests passing, documentation complete               │
│ Mon-Fri (Week 4): Buffer, team training, review, commit              │
│ (Post-Week 4): Begin deprecation of manual testing (2-week sunset)    │
└────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────┐
│ WEEK 5-6: Phase 3 - Resend MCP Integration                            │
├────────────────────────────────────────────────────────────────────────┤
│ Mon-Tue (Week 5): Build EmailService in parallel with placeholder     │
│ Wed: Create email templates, add trigger points                       │
│ Thu-Fri: Testing, validation, production readiness                    │
│ Mon-Fri (Week 6): Enforce email service, remove placeholder, commit  │
│ (Post-Week 6): Begin deprecation of old system (2-week sunset)        │
└────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────┐
│ WEEK 7-8: Phase 4 - PostgreSQL MCP Integration                        │
├────────────────────────────────────────────────────────────────────────┤
│ Mon-Tue (Week 7): Add PostgreSQL MCP to test infrastructure            │
│ Wed: Create RLS policy testing helpers, migration validator            │
│ Thu-Fri: Modernize database workflows, team training                  │
│ Mon-Fri (Week 8): Finalize, document, commit Phase 4                  │
│ (Post-Week 8): Begin deprecation of external tools (2-week sunset)    │
└────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────┐
│ POST-PHASE: Ongoing Monitoring & Cleanup                              │
├────────────────────────────────────────────────────────────────────────┤
│ Week 9-10: Deprecation cleanup (Stripe), second pass                  │
│ Week 11-12: Deprecation cleanup (Resend), second pass                 │
│ Week 13-14: Deprecation cleanup (PostgreSQL), monitor adoption        │
│ Week 15+: Sustainable development with MCP-first workflows            │
└────────────────────────────────────────────────────────────────────────┘
```

---

## Next Steps: Immediate Actions

### This Week
1. **Review this plan** with Gemini and Codex
2. **Confirm timeline** and resource availability
3. **Identify any blockers** or concerns
4. **Get team sign-off** on MCP-first approach

### By End of Week 1
1. **Move to Phase 1 tasks**: Create `.tasks/mcp-integration/` folder
2. **Start Phase 1 implementation**: Infrastructure audit begins
3. **Set up MCP development environment** locally
4. **Create audit documentation**

### By End of Week 2
1. **Phase 1 complete**: All three MCPs operational
2. **Phase 2 ready**: Stripe MCP task creation
3. **Documentation published**: CLAUDE.md updated
4. **Team trained**: Everyone understands plan and MCPs

---

## FAQ: Questions You Might Have

**Q: Will this break existing workflows?**
A: No. Old and new systems coexist for each entire phase. Only after validation do we deprecate (with 2-week notice).

**Q: What if an MCP server fails?**
A: Graceful fallback to traditional methods (Stripe dashboard, psql, etc.). All workflows continue.

**Q: Do we need to change application code?**
A: Minimal changes. MCPs integrate at development/testing layer. Production code largely unchanged.

**Q: What about new developers onboarding?**
A: MCP setup takes <5 minutes. Onboarding docs updated. They work MCP-first, no legacy tool learning.

**Q: How do we measure success?**
A: Development velocity metrics, test coverage improvement, team adoption rates, deployment frequency.

**Q: Can we skip a phase?**
A: Yes, but not recommended. Each phase builds on previous. Phase 1 foundation required for others.

**Q: What's the worst-case scenario?**
A: MCP integration fails, we revert all changes with `git revert`, continue with old workflows. Zero risk to production.

---

## Approval & Sign-Off

This plan requires approval from:
- [ ] **Carlo** (Project Lead): Final sign-off on timeline and approach
- [ ] **Gemini** (Planner): Strategic guidance and task creation
- [ ] **Claude** (Implementer): Feasibility and technical approach
- [ ] **Codex** (Reviewer): Code quality and integration patterns

Once approved:
```bash
git add docs/MCP_*.md
git commit -m "feat(plan): MCP integration master plan for Phase 1 (Stripe, Resend, PostgreSQL)"
git push origin dev
```

---

## Contact & Support

- **Questions about plan**: Review `MCP_INTEGRATION_MASTER_PLAN.md`
- **Architecture questions**: See `MCP_PHASE1_ARCHITECTURE.md`
- **Migration specifics**: Check `MCP_MIGRATION_STRATEGIES.md`
- **Implementation help**: Phase-specific workflow docs
- **Blockers/issues**: Create GitHub issue with `[MCP]` prefix

---

## Document Lineage

| Document | Purpose | Owner |
|----------|---------|-------|
| MCP_INTEGRATION_MASTER_PLAN.md | Executive overview and timeline | Gemini (Planner) |
| MCP_PHASE1_ARCHITECTURE.md | Technical architecture and design | Claude (Architect) |
| MCP_MIGRATION_STRATEGIES.md | Specific migration procedures | Claude (Implementer) |
| STRIPE_MCP_WORKFLOWS.md | Phase 2 testing patterns | Claude (Phase 2) |
| RESEND_MCP_WORKFLOWS.md | Phase 3 email patterns | Claude (Phase 3) |
| POSTGRES_MCP_WORKFLOWS.md | Phase 4 database patterns | Claude (Phase 4) |

All documents linked in `docs/` directory and referenced in CLAUDE.md/AGENTS.md

---

**Status**: Ready for Implementation Review
**Last Updated**: November 2025
**Next Review**: After Phase 1 Completion
**Approval Date**: [To be filled by Carlo]

