# Task 1.2: MCP Server Setup & Configuration

**Task ID**: mcp-integration/1.2
**Epic**: MCP Integration Phase 1
**Owner**: Claude
**Status**: READY TO START
**Effort**: ~12 hours
**Timeline**: Week 1 (Thu)

## Objective

Set up all three MCP servers locally, configure them, test their connectivity and functionality, and document the setup process for the team.

## Deliverables

1. **Configuration File**
   - `.claude/mcp.json` (committed to git - no secrets)

2. **Setup Guide**
   - `.claude/mcp-setup-guide.md` (developer onboarding)

3. **Environment Template**
   - Update `.env.example` with MCP-related variables

4. **Test Results**
   - Document successful initialization of all three MCPs
   - Verify authentication and API connectivity
   - Confirm no errors or warnings

## Subtask 1.2.1: Stripe MCP Setup

### What to Do

1. **Install Stripe MCP Package**
   ```bash
   npm search @modelcontextprotocol/server-stripe
   # or check https://www.npmx.io/ for availability
   ```

2. **Create Stripe MCP Configuration**
   - Get Stripe test API key (sandbox)
   - Get Stripe webhook secret (sandbox)
   - Add to environment variables (never in config file)

3. **Configure .claude/mcp.json**
   ```json
   {
     "mcpServers": {
       "stripe": {
         "command": "npx",
         "args": ["@modelcontextprotocol/server-stripe"],
         "env": {
           "STRIPE_API_KEY": "${STRIPE_API_KEY}",
           "STRIPE_WEBHOOK_SECRET": "${STRIPE_WEBHOOK_SECRET}"
         }
       }
     }
   }
   ```

4. **Test Stripe MCP**
   - Initialize MCP server locally
   - List available tools/commands
   - Test creating a customer (sandbox)
   - Test webhook simulation
   - Verify no errors in output

5. **Document Setup**
   - How to get Stripe sandbox API key
   - Where to find webhook secret
   - Common errors and solutions
   - How to verify it's working

### Acceptance Criteria

- [ ] Stripe MCP package identified and available
- [ ] Configuration added to `.claude/mcp.json`
- [ ] Environment variables documented
- [ ] Server initializes without errors
- [ ] At least 3 Stripe commands available and tested
- [ ] Webhook simulation works
- [ ] Setup documented in guide

---

## Subtask 1.2.2: Resend MCP Setup

### What to Do

1. **Install Resend MCP Package**
   ```bash
   npm search @modelcontextprotocol/server-resend
   # or check https://www.npmx.io/ for availability
   ```

2. **Create Resend MCP Configuration**
   - Get Resend test API key (from dashboard)
   - Add to environment variables (never in config file)

3. **Configure .claude/mcp.json**
   ```json
   {
     "mcpServers": {
       "resend": {
         "command": "npx",
         "args": ["@modelcontextprotocol/server-resend"],
         "env": {
           "RESEND_API_KEY": "${RESEND_API_KEY}"
         }
       }
     }
   }
   ```

4. **Test Resend MCP**
   - Initialize MCP server locally
   - List available tools/commands
   - Test email preview functionality
   - Test template variable rendering
   - Verify no errors in output

5. **Document Setup**
   - How to create Resend account
   - Where to get API key
   - How to use test mode
   - Common errors and solutions
   - How to verify it's working

### Acceptance Criteria

- [ ] Resend MCP package identified and available
- [ ] Configuration added to `.claude/mcp.json`
- [ ] Environment variables documented
- [ ] Server initializes without errors
- [ ] At least 3 email commands available and tested
- [ ] Email preview works
- [ ] Setup documented in guide

---

## Subtask 1.2.3: PostgreSQL MCP Setup

### What to Do

1. **Install PostgreSQL MCP Package**
   ```bash
   npm search @modelcontextprotocol/server-postgres
   # or check https://www.npmx.io/ for availability
   ```

2. **Create PostgreSQL MCP Configuration**
   - Use Supabase PostgreSQL connection string (dev environment)
   - Get from Supabase project settings
   - Add to environment variables (never in config file)

3. **Configure .claude/mcp.json**
   ```json
   {
     "mcpServers": {
       "postgres": {
         "command": "npx",
         "args": ["@modelcontextprotocol/server-postgres"],
         "env": {
           "DATABASE_URL": "${DATABASE_URL}",
           "READ_ONLY": "false"
         }
       }
     }
   }
   ```

4. **Test PostgreSQL MCP**
   - Initialize MCP server locally
   - List available tools/commands
   - Test schema introspection on existing table
   - Test RLS policy inspection
   - Verify database connectivity
   - Verify no errors in output

5. **Document Setup**
   - How to get Supabase connection string
   - Where to add DATABASE_URL
   - Common connection errors
   - How to test connectivity
   - Performance considerations

### Acceptance Criteria

- [ ] PostgreSQL MCP package identified and available
- [ ] Configuration added to `.claude/mcp.json`
- [ ] Environment variables documented
- [ ] Server initializes without errors
- [ ] At least 3 database commands available and tested
- [ ] Schema introspection works
- [ ] RLS policy inspection works
- [ ] Setup documented in guide

---

## Subtask 1.2.4: Environment Variable Documentation

### What to Do

1. **Update `.env.example`**
   ```env
   # MCP Servers - Phase 1 Integration
   # Note: These are for local development only
   # Never commit actual API keys to git

   # Stripe MCP (Sandbox only - never use production keys)
   STRIPE_API_KEY=sk_test_xxxxx
   STRIPE_WEBHOOK_SECRET=whsec_test_xxxxx

   # Resend MCP (Test mode)
   RESEND_API_KEY=re_test_xxxxx

   # PostgreSQL MCP (Dev environment only)
   DATABASE_URL=postgresql://user:password@host:5432/dbname
   ```

2. **Create Setup Instructions**
   - Where to get each API key
   - How to configure locally
   - Security best practices
   - When to use sandbox vs. production

3. **Document in `.claude/mcp-setup-guide.md`**
   - Quick reference section for env vars
   - Security checklist
   - Common mistakes to avoid

### Acceptance Criteria

- [ ] `.env.example` updated with all MCP variables
- [ ] Instructions clear and accurate
- [ ] No actual secrets in files
- [ ] Security guidance provided

---

## Subtask 1.2.5: Create `.claude/mcp-setup-guide.md`

### What to Do

Create comprehensive setup guide with sections:

1. **Introduction** (why MCPs matter, quick overview)

2. **Prerequisites**
   - Node.js 18+ installed
   - npm/pnpm installed
   - API accounts created (Stripe, Resend)

3. **Setup Instructions**
   - For each MCP:
     - Step-by-step installation
     - Environment variable setup
     - Testing/verification
     - Common issues and solutions

4. **Configuration Reference**
   - `.claude/mcp.json` structure explained
   - Each server's configuration options
   - Environment variables required

5. **Testing Each MCP**
   - How to verify Stripe MCP works
   - How to verify Resend MCP works
   - How to verify PostgreSQL MCP works
   - Troubleshooting checklist

6. **Security Best Practices**
   - Never commit API keys
   - Use sandbox/test keys in development
   - Rotate keys periodically
   - Validate environment variables

7. **Quick Reference**
   - Common commands for each MCP
   - Where to find help
   - Links to official documentation

8. **FAQ**
   - How long does setup take?
   - What if MCP doesn't start?
   - How do I know it's working?
   - Can I use production keys?

### Acceptance Criteria

- [ ] Guide complete and comprehensive
- [ ] Instructions tested (actually work)
- [ ] All common issues addressed
- [ ] Clear and easy to follow
- [ ] Setup takes <5 minutes following guide

---

## Overall Success Criteria for Task 1.2

- [ ] All three MCP servers configured
- [ ] `.claude/mcp.json` committed to git
- [ ] All environment variables documented
- [ ] Developer setup guide created and tested
- [ ] Each MCP verified working locally
- [ ] No hardcoded secrets in any files
- [ ] Team can set up in <5 minutes

## References

- MCP Documentation: Check official docs for each server
- Architecture: `docs/MCP_PHASE1_ARCHITECTURE.md` (Configuration section)
- Master Plan: `docs/MCP_INTEGRATION_MASTER_PLAN.md` (Phase 1.2)

## Notes

- Environment variables should be in `.env.local` (never committed)
- Configuration is in `.claude/mcp.json` (committed with ${VAR} placeholders)
- Stripe/Resend use sandbox/test keys only (never production)
- PostgreSQL should use dev environment only (never production database)
- Test each MCP before moving to Phase 1.3

## Troubleshooting Tips

If MCP doesn't start:
1. Check environment variables are set: `echo $STRIPE_API_KEY`
2. Check package is installed: `npm list @modelcontextprotocol/server-stripe`
3. Check configuration syntax in `.claude/mcp.json`
4. Check for network connectivity if connecting to remote service
5. Review MCP server logs for specific error messages

---

**Task Created**: November 2025
**Ready to Start**: Week 1, Thursday
**Due**: Week 1, Friday EOD
